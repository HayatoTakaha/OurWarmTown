<div class="container main-content">
  <div class="row">
    <div class="col-md-3">
      <% if @group.image.attached? %>
        <%= image_tag url_for(@group.image), class: 'img-fluid mb-3' %>
      <% end %>
      <div class="list-group mt-3">
        <h4>グループメンバー (<%= @group.users.count %>)</h4>
        <% @group.users.each do |user| %>
          <%= link_to user.name, user_path(user), class: 'list-group-item list-group-item-action' %>
        <% end %>
      </div>
      <% if @is_owner %>
        <%= link_to 'グループ編集', edit_group_path(@group), class: 'btn btn-primary btn-block btn-sm mt-3 btn-custom' %>
      <% end %>
      <% if @is_member %>
        <%= link_to 'グループ退会', leave_group_path(@group), method: :delete, class: 'btn btn-danger btn-block btn-sm mt-3 btn-custom', data: { confirm: '本当に退会しますか？' } %>
      <% end %>
    </div>
    <div class="col-md-9">
      <h2><%= @group.name %></h2>
      <p><%= @group.description %></p>
      <% if @is_member %>
        <%= link_to '投稿する', new_post_path(group_id: @group.id), class: 'btn btn-success btn-sm btn-custom mb-3' %>
      <% else %>
        <%= form_with url: join_group_path(@group), method: :post do %>
          <%= submit_tag 'このグループに参加', class: 'btn btn-primary btn-sm btn-custom mb-3' %>
        <% end %>
      <% end %>
      <div class="row">
        <% @group_posts.each do |post| %>
          <div class="col-md-4">
            <div class="card mt-3" style="max-width: 300px;">
              <div class="row no-gutters">
                <% if post.images.attached? %>
                  <div class="col-md-4">
                    <%= image_tag url_for(post.images.first), class: 'img-fluid', alt: '投稿画像', style: 'width: 100px; height: 70px; object-fit: cover;' %>
                  </div>
                <% end %>
                <div class="col-md-8">
                  <div class="card-body">
                    <p class="mb-1" style="font-size: 0.8em;">
                      <strong><%= post.user.name %></strong>
                      <span class="text-muted" style="font-size: 0.7em;"><%= post.created_at.in_time_zone('Tokyo').strftime("%Y-%m-%d %H:%M") %></span>
                    </p>
                    <h5 class="card-title" style="font-size: 1em;">
                      <%= link_to truncate(post.title, length: 8), post_path(post), class: 'text-decoration-none' %>
                    </h5>
                    <p class="card-text" style="font-size: 0.8em;"><%= truncate(post.content, length: 8) %></p>
                    <div class="d-flex align-items-center">
                      <i class="fas fa-users mr-1"></i>
                      <span class="mr-2"><%= truncate(post.group.name, length: 6) %></span>
                      <i class="fas fa-heart mr-1"></i>
                      <span class="mr-2"><%= post.likes.count %></span>
                      <i class="fas fa-comment mr-1"></i>
                      <span><%= post.comments.count %></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <div class="d-flex justify-content-center mt-4">
        <%= paginate @group_posts %>
      </div>
    </div>
  </div>
</div>

<style>
  .btn-custom {
    width: auto; 
    display: inline-block; 
  }
  .card {
    margin-bottom: 10px;
  }
  .card-body {
    padding: 10px;
  }
  .card-title a {
    color: #5a5a5a;
  }
  .card-title a:hover {
    color: #ff6347; 
  }
  .img-thumbnail {
    border: none;
    padding: 0;
  }
</style>
