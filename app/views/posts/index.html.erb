<h3 class="display-6 my-4" style="font-family: 'Dancing Script', cursive; color: #5a5a5a;">投稿一覧</h3>
<div class="row">
  <% @posts.each_slice(4) do |post_group| %>
    <% post_group.each do |post| %>
      <div class="col-sm-3 mb-4">
        <div class="card post p-3 border rounded content-box">
          <div class="d-flex align-items-center">
            <div class="mr-3">
              <% if post.user.profile_image.attached? %>
                <%= image_tag post.user.profile_image.variant(resize: "80x80", crop: "50x50+0+0", gravity: "center", quality: "85"), class: 'rounded-circle', style: 'width: 40px; height: 40px; object-fit: cover; display: block; margin: 0 auto;', alt: 'プロフィール画像' %>
              <% else %>
                <%= image_tag 'default_avatar.jpg', class: 'rounded-circle', style: 'width: 40px; height: 40px; object-fit: cover; display: block; margin: 0 auto;', alt: 'デフォルト画像' %>
              <% end %>
              <p class="text-center mb-0" style="font-size: 0.9em;"><%= post.user.name %></p>
            </div>
            <div class="ml-2">
              <h4 class="font-italic post-title mb-0">
                <%= link_to truncate(post.title, length: 7), post, class: 'text-decoration-none' %>
              </h4>
              <p class="post-content mt-2"><%= truncate(post.content, length: 7) %></p>
              <p class="text-muted mb-0" style="font-size: 0.8em;"><%= post.created_at.in_time_zone('Tokyo').strftime("%Y年%m月%d日 %H:%M") %></p>
            </div>
          </div>
          <% if post.images.attached? %>
            <div class="row">
              <% post.images.each do |image| %>
                <div class="col-md-12 mb-2">
                  <%= image_tag image, class: 'img-fluid', style: 'max-height: 80px; max-width: 100%; object-fit: cover;', alt: '投稿画像' %>
                </div>
              <% end %>
            </div>
          <% end %>
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div>
              <p class="text-muted mb-0">
                <i class="fas fa-thumbs-up"></i> <%= post.likes.count %>
              </p>
            </div>
            <div class="ml-auto">
              <p class="text-muted mb-0">
                <i class="fas fa-comment"></i> <%= post.comments.count %>
              </p>
            </div>
          </div>
          <% if post.group.present? %>
            <div class="d-flex align-items-center mt-2">
              <i class="fas fa-users fa-sm mr-2"></i>
              <%= post.group.name %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>

<div class="d-flex justify-content-center">
  <%= paginate @posts %>
</div>

<style>
  .content-box {
    background-color: #FFFAF0;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 5px;
    border: 1px solid #ddd;
  }

  .post-title a {
    color: #5a5a5a;
  }

  .post-title a:hover {
    color: #ff6347;
  }

  .post-content {
    margin-bottom: 10px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
